# ASR сервис (Распознавание речи)

## Описание

ASR (Automatic Speech Recognition) сервис — это компонент платформы EdTech AI, предназначенный для автоматического преобразования аудио в текст. Он использует технологию OpenAI Whisper для точного и надежного распознавания речи на различных языках.

## Функциональность

- **Преобразование аудио в текст**: Принимает аудио файлы и возвращает их текстовое представление
- **Определение языка**: Автоматически определяет язык речи в аудио
- **Подсчет продолжительности**: Возвращает длительность аудио материала
- **Аутентификация**: Защита API ключами для безопасности

## Поддерживаемые форматы

Следующие форматы аудио и видео поддерживаются:

- Аудио: `mp3`, `wav`, `m4a`
- Видео: `mp4`, `mpga`, `m4v`, `avi`, `mov`, `flv`, `mkv`, `webm`

## Установка и запуск

### Локальный запуск

1. Убедитесь, что установлены зависимости:
   ```bash
   pip install poetry
   cd asr
   poetry install
   ```

2. Запустите приложение:
   ```bash
   poetry run python main.py
   ```

### Запуск в Docker

Сервис также может быть запущен как часть всей системы через Docker Compose:

```bash
docker-compose up -d asr
```

## Конфигурация

Сервис использует следующий параметр конфигурации:

- `SECRET_TOKEN`: API ключ для аутентификации запросов к сервису

## API Endpoints

### `/transcribe` (POST)

#### Описание
Преобразует загруженный аудио файл в текст с использованием Whisper. Для доступа требуется аутентификация API ключом.

#### Заголовки
- `Authorization`: Заголовок аутентификации (API ключ передается через переменную `SECRET_TOKEN`)

#### Параметры запроса
- `file`: Загружаемый аудио/видео файл (multipart/form-data)

#### Пример запроса
```bash
curl -X POST "http://localhost:8000/transcribe" \
  -H "Authorization: Bearer YOUR_SECRET_TOKEN" \
  -F "file=@audio.mp3"
```

#### Ответ
```json
{
  "text": "Текст распознанной речи",
  "language": "язык речи (например, 'en', 'ru')",
  "duration": 123.45
}
```

#### Поля ответа
- `text`: Текстовая транскрипция аудио
- `language`: Язык речи (опционально)
- `duration`: Продолжительность аудио в секундах (опционально)

#### Возможные ошибки
- `400 Bad Request`: Неподдерживаемый формат файла
- `401 Unauthorized`: Отсутствует или неправильный API ключ
- `500 Internal Server Error`: Ошибка обработки аудио файла

### `/health` (GET)

#### Описание
Проверяет работоспособность сервиса.

#### Пример запроса
```bash
curl -X GET "http://localhost:8000/health"
```

#### Ответ
```json
{
  "status": "OK"
}
```

## Модель распознавания

Сервис использует модель Whisper с названием `small`, которая обеспечивает хороший баланс между точностью и скоростью обработки. Эта модель поддерживает несколько языков и автоматически определяет язык входящего аудио.

## Безопасность

Для защиты API все эндпоинты требуют аутентификации через API ключ. Значение ключа устанавливается через переменную окружения `SECRET_TOKEN`.

## Технологии

- **FastAPI**: Современный фреймворк для создания API
- **OpenAI Whisper**: Модель распознавания речи от OpenAI
- **Docker**: Контейнеризация приложения для легкого развёртывания

## Использование в системе

Сервис ASR интегрирован в общую систему EdTech AI и используется сервисом LLM для преобразования аудио запросов пользователей в текст перед обработкой с помощью языковых моделей.</content>